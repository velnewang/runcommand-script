:: mklink runtime by _current
@ECHO off
CALL :find_dp0

:config
SET LINK_PREFIX=R:\
SET TARGET_NAME=_current
SET STATIC_CMD_PREFIX=R:\runtime-static\

:start
:: check prefix
SET CMD_PREFIX=%dp0:~0,18%
IF %STATIC_CMD_PREFIX% neq %CMD_PREFIX% ( GOTO end )
CD /d %dp0%
PUSHD
CD ..\
SET CMD_PARENT=%CD%\
POPD
IF %STATIC_CMD_PREFIX% neq %CMD_PARENT% ( GOTO end )
:: set and check
FOR %%a IN ( %dp0:\= % ) DO SET LINK_NAME=%%a
SET LINK_PATH=%LINK_PREFIX%%LINK_NAME%\
SET TARGET_PATH=%dp0%%TARGET_NAME%\
IF EXIST %LINK_PATH% ( GOTO end )
IF NOT EXIST %TARGET_PATH% ( GOTO end )

:mklink_d
mklink /d %LINK_PATH% %TARGET_PATH%
GOTO end

:end
ECHO end

:find_dp0
SET dp0=%~dp0
EXIT /b
